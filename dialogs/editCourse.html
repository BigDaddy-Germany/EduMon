<div id="dialogContainer">
	<header>
		<h2>Edit Course</h2>
		<h3>Please insert your content here</h3>
	</header>
		Please insert data etc.:<br><br>
		Course name: <input type="text" id="courseName"><br><br>
		Members:<br>


		<div class="courseMemberLine">
			Name: <input type="text" class="courseMemberName">
			Group <input type="text" class="courseMemberGroup">
			<span class="courseMemberDelete">[-]</span>
		</div>
		<div id="courseMemberAdd">[+]</div>

		<br><br>
		<span id="courseCsvImport">[CSV Import]</span>
	<footer>
		<button id="dialogBtnBack" type="button" class="btn btn-default">Abort</button>
		<button id="dialogBtnSubmit" type="button" class="btn btn-primary">Save Data</button>
	</footer>
</div>

<script type="text/javascript">
	$(function() {

		/**
		 * Deletes a member row out of the form
		 * @param {Event} event the event triggered by the click on the minus button
		 */
		function deleteMember(event) {
			var member = $(event.target).parent();

			var lineCount = $('.courseMemberLine').length;
			if (lineCount > 1) {
				member.remove();
			}
		}

		/**
		 * Adds a new line to the form
		 */
		function addLine() {
			var lastLine = $('.courseMemberLine').last();
			lastLine.after(lastLine[0].outerHTML);

			// set the delete listeners again (at least one additional field, yet)
			$('.courseMemberDelete')
					.off('click')
					.on('click', deleteMember);
		}

		/**
		 * Imports the data gotten by the CSV importer
		 * @param {Array} csvData The given CSV data
		 */
		function importCsvData(csvData) {
			var existingNames = [];
			$('.courseMemberName').each(function() {
				existingNames.push($(this).val());
			});

			csvData.forEach(function(dataLine) {
				var nameIndex = existingNames.indexOf(dataLine[0]);

				if (nameIndex == -1) {
					addLine();
					existingNames.push(dataLine[0]);
					nameIndex = existingNames.length - 1;
				}

				var nameFields = $('.courseMemberName');
				var groupFields = $('.courseMemberGroup');

				nameFields.eq(nameIndex).val(dataLine[0]);
				groupFields.eq(nameIndex).val(dataLine[1]);
			});
		}

		// add new lines to the member form by clicking on the add button
		$('#courseMemberAdd').on('click', addLine);

		// set the delete listeners
		$('.courseMemberDelete').on('click', deleteMember);

		// listener to import csv data
		$('#courseCsvImport').on('click', function() {

			EduMon.UserInteraction.openStackedDialog(
					EduMon.UserInteraction.importCsvContent,
					[])
					.then(function(data) {
						importCsvData(data);
					})
					.catch(function(data) {
						console.log(data);
					});

		});
	})
</script>